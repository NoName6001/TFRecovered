# TFRecovered

This is an attempt at recreating a Unity Project from [True Facials v0.39](https://mega.nz/file/GPYDRI5B#eXAydXpca5W9K35Xv8_c2N7lcSiOM6IQk9w9fU941_o)

## What has been done:

By using [UtinyRipper](https://github.com/mafaca/UtinyRipper) on the build, we can recreate a mostly complete unity project.  
(it generated a Unity 2017 project that has been re-upgraded to the original build version of Unity 2019.3.5f)

However, 2 important things are wrong with the resulting project:
* C# code contains only inspector fields but no logic
* Shaders are incompatible, they trigger a syntax error from Unity

To recover the C# code, [DnSpy](https://github.com/dnSpy/dnSpy) seems to be the best option since the original project used Unity Mono Bleeding Edge

Running DnSpy's Debugger with the game has not been done successfully.  
To do so, you need to recompile a [DnSpy patched version of mono-2.0-bdwgc.dll](https://github.com/dnSpy/dnSpy-Unity-mono) for the correct version of Unity 2019.3.5f, which I gave up on trying.

Running DnSpy on the game's Assembly-CSharp.dll (located in TrueFacials_Data/Managed/) lets us see decompiled code and export the classes files.

Another issue we can see here is the Obfuscated names of most variable, methods and classes.  
This the product of a unity package named BeeByte, an obfuscator that changes names to random letters.

There are also multiple uses of accessor methods using `k__backingField` which are generated by the compiler when using auto properties like `myVariable {get; set;}`  
We need to change those back to the variable they represent to get the scripts to work again in the Unity project.

And there are also multiples uses of `<>c.<>9` which is again generated by the compiler, this time when using Anonymous functions `() => {}`  
I don't yet know how to fix those.

### Using a previous version without obfuscation

The last non-obfuscated version is v0.34C, [patreon posts](https://yiff.party/patreon/23228933)
using the same process, we can maybe manage to get a clean base to then upgrade from v0.34C to v0.39 by comparing the decompiled code with its v0.34 counterpart

## Packages used by the game

The game uses a number of unity packages, some of which aren't free.  
They are:
- Amplify Shader Editor (Shader editor)
- Curvy Splines (for Splines, used by the smears)
- Final IK (for Inverse Kinematics)
- Puppet Master (for animating an Active Ragdoll)
- Magica Cloth (for Cloth and hair physics)
- Non-Convex Mesh Collider
- OVR lip sync (for automated lipsyncing of audio lines)
- MoonSharp (for parsing Lua scripts)